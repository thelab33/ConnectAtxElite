{# app/templates/base.html #}
<!doctype html>
<html lang="en" data-theme="{{ request.cookies.get('theme', 'dark') }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{% block title %}Connect ATX Elite{% endblock %}</title>

    {# ── SEO & Social Cards ── #}
    <meta
      name="description"
      content="Empowering youth through basketball, brotherhood and academics in Austin, TX."
    />
    <meta property="og:title" content="Connect ATX Elite" />
    <meta
      property="og:description"
      content="Empowering youth through basketball, brotherhood and academics in Austin, TX."
    />
    <meta
      property="og:image"
      content="{{ url_for('static', filename='images/social-preview.png') }}"
    />
    <meta name="twitter:card" content="summary_large_image" />

    {# ── PWA / Icons ── #}
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', filename='favicon.ico') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', filename='apple-touch-icon.png') }}"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='site.webmanifest') }}"
    />
    <meta name="theme-color" content="#facc15" />

    {# ── Preloads ── #}
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      href="{{ url_for('static', filename='tailwind.min.css') }}"
      as="style"
      fetchpriority="high"
    />
    <link
      rel="preload"
      href="{{ url_for('static', filename='connect-atx-team.jpg') }}"
      as="image"
      fetchpriority="high"
    />

    {# ── Styles ── #}
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='tailwind.min.css') }}"
      fetchpriority="high"
    />
    {% block extra_styles %}{% endblock %}
    <style>
      :root {
        --primary: #facc15;
        --dark-bg: #18181b;
        --header-glow: 0 0 8px #facc1555;
      }
      [data-theme='dark'] {
        --dark-bg: #101015;
      }
      html,
      body {
        background: var(--dark-bg);
        color: #f0f0f0;
        scroll-behavior: smooth;
      }
      #scroll-progress {
        position: fixed;
        top: 0;
        left: 0;
        height: 4px;
        width: 0;
        background: var(--primary);
        box-shadow: var(--header-glow);
        z-index: 60;
        transition: width 0.14s cubic-bezier(0.4, 0, 0.2, 1);
      }
    </style>
  </head>
  <body
    class="flex flex-col min-h-screen antialiased bg-zinc-950 text-white selection:bg-primary selection:text-black"
  >
    <!-- ────────────── Scroll Progress Bar ────────────── -->
    <div id="scroll-progress" aria-hidden="true"></div>

    <!-- ────────────── Accessibility: Skip to main content ────────────── -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only fixed top-4 left-4 z-50 bg-primary text-black px-4 py-2 rounded shadow-lg font-bold"
    >
      Skip to main content
    </a>

    <!-- ────────────── Fixed Theme Toggle (desktop) ────────────── -->
    <button
      id="theme-toggle"
      aria-label="Toggle theme"
      class="fixed top-4 right-4 z-50 p-2 rounded-full bg-zinc-800 shadow hover:bg-primary/80 focus:outline-none"
    >
      🌙
    </button>

    <!-- ────────────── Global Header Partial ────────────── -->
    {% include "partials/header.html" %}

    <!-- ────────────── Main Content Area (all page sections) ────────────── -->
    <main
      id="main-content"
      tabindex="-1"
      class="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"
    >
      {% block content %}{% endblock %}
    </main>

    <!-- ────────────── Footer & Global Modals ────────────── -->
    {% include "partials/footer.html" %} {% include
    "partials/donation_modal.html" ignore missing %} {% include
    "partials/back_to_top.html" ignore missing %} {% include
    "partials/live_chat.html" ignore missing %}

    <!-- ────────────── Cookie Consent Banner ────────────── -->
    <div
      id="cookie-consent"
      class="fixed bottom-4 left-1/2 -translate-x-1/2 z-[9999] hidden bg-zinc-800 text-white text-sm rounded-full px-6 py-3 shadow-lg"
      role="dialog"
      aria-live="polite"
    >
      We use cookies.
      <a class="text-primary underline" href="/privacy">Privacy Policy</a>
      <button
        id="cookie-accept"
        class="ml-4 bg-primary text-black font-bold px-3 py-1 rounded-full shadow"
      >
        Accept
      </button>
    </div>

    <!-- ────────────── Scripts ────────────── -->
    <script
      src="{{ url_for('static', filename='js/bundle.min.js') }}"
      defer
    ></script>
    <script>
      // Scroll progress bar
      window.addEventListener('scroll', () => {
        const h = document.documentElement.scrollHeight - innerHeight;
        document.getElementById('scroll-progress').style.width =
          (scrollY / h) * 100 + '%';
      });

      // Theme toggle
      const toggle = document.getElementById('theme-toggle');
      const apply = (t) => {
        document.documentElement.setAttribute('data-theme', t);
        toggle.textContent = t === 'dark' ? '🌙' : '☀️';
        localStorage.theme = t;
      };
      toggle.addEventListener('click', () => {
        apply(
          document.documentElement.getAttribute('data-theme') === 'dark'
            ? 'light'
            : 'dark'
        );
      });
      if (localStorage.theme) apply(localStorage.theme);

      // Cookie banner
      document.addEventListener('DOMContentLoaded', () => {
        const bar = document.getElementById('cookie-consent');
        if (!localStorage.cookieConsent) bar.classList.remove('hidden');
        document
          .getElementById('cookie-accept')
          .addEventListener('click', () => {
            localStorage.cookieConsent = 'true';
            bar.classList.add('hidden');
          });
      });
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
